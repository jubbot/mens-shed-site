---
/**
 * Props:
 * - title: string
 * - summary?: string
 * - url?: string (absolute canonical; defaults to current page)
 * - hashtags?: string[]
 * - utmCampaign?: string
 */
const {
  title,
  summary = '',
  url,
  hashtags = ['MensShedTownsville','Community','Volunteer'],
  utmCampaign = 'projects'
} = Astro.props as {
  title: string;
  summary?: string;
  url?: string;
  hashtags?: string[];
  utmCampaign?: string;
};

const SITE_URL = Astro.url?.href ?? '';
const baseUrl = (SITE_URL || url || '').replace(/#.*$/, '');
const sep = baseUrl.includes('?') ? '&' : '?';
const urlWithUtm = baseUrl
  ? `${baseUrl}${sep}utm_source=direct&utm_medium=social&utm_campaign=${encodeURIComponent(utmCampaign)}`
  : '';

const enc = encodeURIComponent;
const encUrl = enc(urlWithUtm || baseUrl);
const encTitle = enc(title);
const encText = enc(summary || title);

const share = {
  facebook: `https://www.facebook.com/sharer/sharer.php?u=${encUrl}`,
  x:        `https://twitter.com/intent/tweet?url=${encUrl}&text=${encTitle}&hashtags=${enc(hashtags.join(','))}`,
  linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${encUrl}`,
  email:    `mailto:?subject=${enc(`Check this out: ${title}`)}&body=${enc(`${summary ? summary + '\n\n' : ''}${urlWithUtm || baseUrl}`)}`
};
---

{baseUrl && (
  <section class="share">
    <h2 class="share-title">Share this project</h2>
    <div class="share-row">
      <a class="btn btn-facebook" href={share.facebook} target="_blank" rel="noopener"><i class="wt-facebook"></i></a>
      <a class="btn btn-x" href={share.x} target="_blank" rel="noopener"><i class="wt-x"></i></a>
      <a class="btn btn-linkedin" href={share.linkedin} target="_blank" rel="noopener"><i class="wt-linkedin"></i></a>
      <a class="btn btn-email" href={share.email}><i class="wt-mail"></i></a>
      <button class="btn btn-delta btn-secondary" type="button" data-copy><i class="wt-copy"></i> Copy</button>
      <button class="btn btn-delta btn-primary" type="button" data-webshare aria-label="Share">Shareâ€¦</button>
    </div>
  </section>
)}

 

<script is:inline>
  (function () {
    var root = document.querySelector('section.share');
    if (!root) return;

    var copyBtn = root.querySelector('[data-copy]');
    var shareBtn = root.querySelector('[data-webshare]');
    var plainUrl = window.location.href;

    function flash(el, text) {
      var orig = el.textContent;
      el.textContent = text;
      setTimeout(function(){ el.textContent = orig; }, 1200);
    }

    copyBtn && copyBtn.addEventListener('click', function () {
      navigator.clipboard?.writeText(plainUrl).then(
        function(){ flash(copyBtn, 'Copied!'); },
        function(){ flash(copyBtn, 'Copy failed'); }
      );
    });

    shareBtn && shareBtn.addEventListener('click', function () {
      if (!navigator.share) { copyBtn?.click(); return; }
      navigator.share({ title: document.title, url: plainUrl }).catch(function(){});
    });
  })();
</script>
