---
export const prerender = false;

import Layout from '../../../layouts/Dashboard-Layout.astro';
import { getSupabaseServerClient } from '../../../lib/supabaseServer';

const supa = getSupabaseServerClient({ request: Astro.request, cookies: Astro.cookies });
const { data: { user } } = await supa.auth.getUser();
if (!user) return Astro.redirect('/login?next=/dashboard/members/new');

const { data: me } = await supa.from('members').select('role,is_active').eq('id', user.id).single();
const isStaff = me?.is_active && ['admin','staff'].includes(me.role);
if (!isStaff) return Astro.redirect('/dashboard?forbidden=1');
---

<Layout title="Invite Member">
  <div class="wrap">
    <h1>Invite new member</h1>
    <form method="post" action="/api/admin/members/create" class="form">
      <label>Full name
        <input name="full_name" required />
      </label>
      <label>Email
        <input name="email" type="email" required />
      </label>
      <label>Role
        <select name="role">
          <option value="member">Member</option>
          <option value="staff">Staff</option>
          <option value="admin">Admin</option>
        </select>
      </label>

      <div class="actions">
        <a class="btn btn-ghost" href="/dashboard/members">Cancel</a>
        <button class="btn btn-primary" type="submit">Invite</button>
      </div>
    </form>
  </div>

  <style>
    .wrap { width:min(700px,92%); margin:0 auto; }
    .form { display:grid; gap:.9rem; margin-top:.75rem; }
    label { display:grid; gap:.35rem; }
    input, select { padding:.6rem .7rem; border:1px solid var(--border,#e5e7eb); border-radius:10px; }
    .actions { display:flex; gap:.6rem; justify-content:flex-end; margin-top:.5rem; }
    .btn { display:inline-flex; align-items:center; gap:.4rem; border-radius:10px; padding:.5rem .8rem; text-decoration:none; }
    .btn-primary { background:#2a7f62; color:#fff; border:0; }
    .btn-ghost { color:#2a7f62; border:1px solid #2a7f62; }
  </style>
</Layout>
