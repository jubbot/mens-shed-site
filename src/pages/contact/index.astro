---
import Layout from '../../layouts/Layout.astro';
import RotatingQuotes from '../../components/RotatingQuotes.astro';
// If you have SmartMapLink, uncomment next line and use it below
// import SmartMapLink from '../../components/SmartMapLink.astro';

const COORDS = { lat: -19.26920036602045, lng: 146.80581755020592 };
const googlePlace = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(`${COORDS.lat},${COORDS.lng}`)}`;
---

<Layout title="Contact">
  <div class="wrapper contact">
      <p id="form-status" class="status" role="status" aria-live="polite"></p>
   <div class="grid gap banner">
        <div>
        <nav class="crumbset" aria-label="Breadcrumb">
          <a href="/">Home</a> <span aria-hidden="true">/</span> <a href="/contact">Contact</a>
        </nav>

        <h1 id="contact-title" class="l-txt">Get in Touch</h1>
        <h3>Have a question, want to visit the shed, or looking to get involved? We’d love to hear from you.</h3>
        </div>
</div>

    <section>
    <div class="grid">
<div class="l-6 m-6 s-12" aria-labelledby="contact-title">
        <!-- Primary actions (revealed on click to reduce scraping) -->
        <div class="contact-actions">
          <button type="button" class="btn btn-alpha" data-reveal="phone"><i class="wt-phone"></i> Call us</button>
          <button type="button" class="btn btn-delta" data-reveal="email"><i class="wt-mail"></i> Email us</button>
          <a class="btn btn-delta" href={googlePlace} target="_blank" rel="noopener">
            <i class="wt-pin"></i> Get directions
          </a>
        </div>

        <!-- Quick info -->
        <div class="grid info-cards">
          <div class="l-6 m-6 s-12">
            <h4><i class="wt-clock"></i> Open Hours</h4>
            <p><strong>8:00 AM – 12:00 PM</strong><br/>Mon · Tue · Wed · Thu · Fri</p>
          </div>
          <div class="l-6 m-6 s-12">
            <h4><i class="wt-pin"></i> Visit</h4>
            <p>
              <a class="addr-link" href={googlePlace} target="_blank" rel="noopener">
                1 Charters Towers Road<br/>Townsville, QLD 4810
              </a>
            </p>
          </div>
        </div>
      

      <aside>
        <h2 id="support-title" class="sr-only">Ways to support the Shed</h2>
        <ul class="support-list">
          <li><strong>Make a Donation</strong><br/>Every dollar helps us buy materials, maintain tools, and keep the lights on.</li>
          <li><strong>Become a Sponsor</strong><br/>Support local men’s mental health and community work while promoting your business.</li>
          <li><strong>Donate Tools or Materials</strong><br/>Quality tools, timber, and hardware are always needed and appreciated.</li>
          <li><strong>Join a Fundraiser</strong><br/>Get involved in BBQs, raffles, and events that help keep the shed running.</li>
          <li><strong>Fund a Project or Workshop</strong><br/>Help us deliver free training, repair services, or build items for the community.</li>
          <li><strong>Spread the Word</strong><br/>Share our work, attend events, or refer someone who might benefit from the shed.</li>
        </ul>

        <!-- Friendly rotating quote (auto every 10s) -->
        <div class="quotes">
          <RotatingQuotes intervalMs={10000} />
        </div>
      </aside>
</div>
<div class="l-6 m-6 s-12">
      <form name="contact" method="POST" data-netlify="true" netlify-honeypot="company" data-netlify-recaptcha="true">
    <!-- Required hidden input so Netlify can match posts -->
    <input type="hidden" name="form-name" value="contact" />

    <!-- Honeypot: keep *visible* in HTML but offscreen -->
    <p class="hp" aria-hidden="true">
      <label>Company <input name="company" tabindex="-1" autocomplete="off" /></label>
    </p>

    <!-- Your fields (unchanged, but keep `name=`s!) -->
    <div class="form-group">
      <label for="contact-fullName">Full Name <span class="req">*</span></label>
      <input type="text" id="contact-fullName" name="fullName" required autocomplete="name" placeholder="Jane Citizen" />
    </div>

    <div class="form-group">
      <label for="contact-email">Email <span class="req">*</span></label>
      <input type="email" id="contact-email" name="email" required autocomplete="email" inputmode="email" placeholder="you@example.com" />
    </div>

    <div class="form-group">
      <label for="contact-phone">Phone Number</label>
      <input type="tel" id="contact-phone" name="phone" autocomplete="tel" inputmode="tel" placeholder="07 4772 4422" pattern="^[0-9 +()-]{6,}$" />
    </div>

    <fieldset class="form-group">
      <legend class="form-label">General Enquiry</legend>
      <div class="radio-group-inline" role="radiogroup" aria-label="General Enquiry">
        <label class="radio-option"><input type="radio" name="enquiryType" value="membership" /> <span>Membership Information</span></label>
        <label class="radio-option"><input type="radio" name="enquiryType" value="volunteering" /> <span>Volunteering Opportunities</span></label>
        <label class="radio-option"><input type="radio" name="enquiryType" value="donation" /> <span>Donations & Support</span></label>
        <label class="radio-option"><input type="radio" name="enquiryType" value="workshop" /> <span>Workshop or Project Ideas</span></label>
        <label class="radio-option"><input type="radio" name="enquiryType" value="other" /> <span>Other</span></label>
      </div>
    </fieldset>

    <div class="form-group">
      <label for="contact-message">How can Men’s Shed Townsville help?</label>
      <textarea id="contact-message" name="message" rows="6" spellcheck="true" placeholder="Tell us a little about your enquiry…"></textarea>
    </div>

    <div class="form-group">
      <label class="checkbox">
        <input type="checkbox" name="consent" required />
        <span>I agree to be contacted about my enquiry. See our <a href="/privacy" target="_blank" rel="noopener">privacy policy</a>.</span>
      </label>
    </div>
    <div class="form-group">
        <div data-netlify-recaptcha="true"></div>
    </div>
    <div class="actions">
      <button type="submit" class="btn btn-alpha">
        <i class="wt-mail"></i> Pass the message along
      </button>
    </div>
  </form>
</div>
</div>
</section>

  
   
    <!-- Map -->
    <section class="direction">
      <iframe
        class="map"
        title="Men’s Shed Townsville location on Google Maps"
        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d7532.604403607848!2d146.8058136!3d-19.26922!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x6bd5f919194a442b%3A0xd06b7aedc23c326b!2s1%20Charters%20Towers%20Rd%2C%20West%20End%20QLD%204810!5e0!3m2!1sen!2sau!4v1748320429390!5m2!1sen!2sau"
        loading="lazy"
        referrerpolicy="no-referrer-when-downgrade"
        style="border:0; width:100%; height:420px;"
        allowfullscreen
      ></iframe>
    </section>

  </div>

 
<script is:inline>
(() => {
  const form = document.querySelector('form[name="contact"]');
  const status = document.getElementById('form-status');
  if (!form || !status || !window.fetch) return;

  const encode = (data) =>
    Object.keys(data)
      .map((k) => encodeURIComponent(k) + '=' + encodeURIComponent(data[k]))
      .join('&');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    status.textContent = 'Sending…';

    const fd = new FormData(form);
    // Netlify requires form-name as part of the payload
    fd.append('form-name', form.getAttribute('name'));

    try {
      const res = await fetch('/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: encode(Object.fromEntries(fd))
      });
      if (!res.ok) throw new Error('Network');
      status.textContent = 'Thanks! We’ll be in touch shortly.';
      form.reset();
    } catch {
      status.textContent = 'Sorry, something went wrong. Please try again or email us directly.';
    }
  });
})();
</script>


  <!-- Reveal phone/email + progressive enhancement submit -->
  <script is:inline>
    (() => {
      // Reveal handlers (reduce scraping of raw text)
      const phoneBtn = document.querySelector('[data-reveal="phone"]');
      const emailBtn = document.querySelector('[data-reveal="email"]');
      const phoneHuman = '07 4772 4422';
      const phoneDial  = '0747724422';
      const user = 'townsvillemensshed';
      const host = 'gmail.com';

      phoneBtn?.addEventListener('click', () => {
        phoneBtn.innerHTML = '<i class="wt-phone"></i> ' + phoneHuman;
        window.location.href = 'tel:' + phoneDial;
      });
      emailBtn?.addEventListener('click', () => {
        const addr = user + '@' + host;
        emailBtn.innerHTML = '<i class="wt-mail"></i> ' + addr;
        window.location.href = 'mailto:' + addr;
      });

      // Progressive enhancement for form submit: try fetch to /api/contact; otherwise fall back to normal POST
      const form = document.getElementById('contact-form');
      const status = document.getElementById('form-status');

      form?.addEventListener('submit', async (e) => {
        // honeypot check
        const hp = (form.querySelector('input[name="company"]') || {}).value || '';
        if (hp.trim() !== '') return; // bots: let server discard

        if (!window.fetch) return; // no JS enhancement; let browser submit

        e.preventDefault();
        status.textContent = 'Sending…';

        const data = Object.fromEntries(new FormData(form));
        try {
          const res = await fetch(form.getAttribute('action') || '/api/contact', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          const j = await res.json().catch(() => ({}));
          if (!res.ok) throw new Error(j?.error || 'Failed');

          status.textContent = 'Thanks! We’ll be in touch shortly.';
          form.reset();
          // Optional: scroll to status
          status.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } catch (err) {
          console.error(err);
          status.textContent = 'Sorry, something went wrong. Please try again or email us directly.';
        }
      });
    })();
  </script>
 
</Layout>
